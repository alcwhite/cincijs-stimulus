<li class="assignment" id="assignment-li-<%= assignment.id %>">
  <%= turbo_frame_tag dom_id(assignment), class: "assignment__role role" do %>
    <span><%= assignment.person_name %></span>
    <div class="role__details">
    </div>
  <% end %>
  <div
    class="assignment__timeline"
    data-controller="drag-assignment-week"
    data-drag-assignment-week-assignment-id-value="<%= assignment.id %>"
    data-drag-assignment-week-selected-class="timeline__selected"
    data-drag-assignment-week-opacity-class="timeline__dragging"
  >
    <ul class="timeline">
      <% 0.upto(total_weeks - 1) do |week| %>
        <% assignment_week = assignment.assignment_weeks.detect { |aw| aw.week == grid_dates[week] } %>
        <% assignment_week ||= AssignmentWeek.new(assignment: assignment, week: grid_dates[week]) %>
        <% track = assignment_week.new_record? ? '__empty' : '__fill' %>
        <%= turbo_frame_tag assignment_week_dom_id(assignment_week), role: "listitem", class: "timeline__grid-cell #{this_week_class(grid_dates[week])}", style: "grid-column: #{week + 1}" do %>
          <% action = "dragstart->drag-assignment-week#dragstart dragenter->drag-assignment-week#dragenter dragend->drag-assignment-week#dragend" %>
          <% if assignment_week.new_record? %>
            <%= render partial: 'assignment_weeks/timeline_empty_cell', locals: {assignment_id: assignment.id, week: grid_dates[week], action: action} %>
          <% else %>
            <%= render partial: 'assignment_weeks/assignment_week', object: assignment_week, locals: {action: action} %>
          <% end %>
        <% end %>
      <% end %>
    </ul>
    <%= form_for :assignment_week, url: copy_week_assignment_weeks_path(format: :turbo_stream), method: :post, html: { data: { drag_assignment_week_target: "form" } } do |f| %>
        <%= f.hidden_field :assignment_id, value: assignment.id %>
        <%= f.hidden_field :source_week, value: nil, data: { drag_assignment_week_target: "sourceWeek" } %>
        <%= f.hidden_field :destination_week, value: nil, data: { drag_assignment_week_target: "destinationWeek" } %>
    <% end %>
  </div>
</li>
